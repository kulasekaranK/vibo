"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1654],{1654:(O,T,m)=>{m.r(T),m.d(T,{Tab3Page:()=>x});var u=m(467),g=m(4341),v=m(177),d=m(2220),_=m(3273),b=m(6946),h=m(5083),f=function(l){return l.Prompt="PROMPT",l.Camera="CAMERA",l.Photos="PHOTOS",l}(f||{}),P=function(l){return l.Rear="REAR",l.Front="FRONT",l}(P||{}),w=function(l){return l.Uri="uri",l.Base64="base64",l.DataUrl="dataUrl",l}(w||{});class F extends h.E_{getPhoto(o){var r=this;return(0,u.A)(function*(){return new Promise(function(){var n=(0,u.A)(function*(t,i){if(o.webUseInput||o.source===f.Photos)r.fileInputExperience(o,t,i);else if(o.source===f.Prompt){let s=document.querySelector("pwa-action-sheet");s||(s=document.createElement("pwa-action-sheet"),document.body.appendChild(s)),s.header=o.promptLabelHeader||"Photo",s.cancelable=!1,s.options=[{title:o.promptLabelPhoto||"From Photos"},{title:o.promptLabelPicture||"Take Picture"}],s.addEventListener("onSelection",function(){var a=(0,u.A)(function*(c){0===c.detail?r.fileInputExperience(o,t,i):r.cameraExperience(o,t,i)});return function(c){return a.apply(this,arguments)}}())}else r.cameraExperience(o,t,i)});return function(t,i){return n.apply(this,arguments)}}())})()}pickImages(o){var r=this;return(0,u.A)(function*(){return new Promise(function(){var n=(0,u.A)(function*(t,i){r.multipleFileInputExperience(t,i)});return function(t,i){return n.apply(this,arguments)}}())})()}cameraExperience(o,r,n){var t=this;return(0,u.A)(function*(){if(customElements.get("pwa-camera-modal")){const i=document.createElement("pwa-camera-modal");i.facingMode=o.direction===P.Front?"user":"environment",document.body.appendChild(i);try{yield i.componentOnReady(),i.addEventListener("onPhoto",function(){var s=(0,u.A)(function*(a){const c=a.detail;null===c?n(new h.I9("User cancelled photos app")):c instanceof Error?n(c):r(yield t._getCameraPhoto(c,o)),i.dismiss(),document.body.removeChild(i)});return function(a){return s.apply(this,arguments)}}()),i.present()}catch{t.fileInputExperience(o,r,n)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),t.fileInputExperience(o,r,n)})()}fileInputExperience(o,r,n){let t=document.querySelector("#_capacitor-camera-input");const i=()=>{var s;null===(s=t.parentNode)||void 0===s||s.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input",t.type="file",t.hidden=!0,document.body.appendChild(t),t.addEventListener("change",s=>{const a=t.files[0];let c="jpeg";if("image/png"===a.type?c="png":"image/gif"===a.type&&(c="gif"),"dataUrl"===o.resultType||"base64"===o.resultType){const p=new FileReader;p.addEventListener("load",()=>{if("dataUrl"===o.resultType)r({dataUrl:p.result,format:c});else if("base64"===o.resultType){const y=p.result.split(",")[1];r({base64String:y,format:c})}i()}),p.readAsDataURL(a)}else r({webPath:URL.createObjectURL(a),format:c}),i()}),t.addEventListener("cancel",s=>{n(new h.I9("User cancelled photos app")),i()})),t.accept="image/*",t.capture=!0,o.source===f.Photos||o.source===f.Prompt?t.removeAttribute("capture"):o.direction===P.Front?t.capture="user":o.direction===P.Rear&&(t.capture="environment"),t.click()}multipleFileInputExperience(o,r){let n=document.querySelector("#_capacitor-camera-input-multiple");const t=()=>{var i;null===(i=n.parentNode)||void 0===i||i.removeChild(n)};n||(n=document.createElement("input"),n.id="_capacitor-camera-input-multiple",n.type="file",n.hidden=!0,n.multiple=!0,document.body.appendChild(n),n.addEventListener("change",i=>{const s=[];for(let a=0;a<n.files.length;a++){const c=n.files[a];let p="jpeg";"image/png"===c.type?p="png":"image/gif"===c.type&&(p="gif"),s.push({webPath:URL.createObjectURL(c),format:p})}o({photos:s}),t()}),n.addEventListener("cancel",i=>{r(new h.I9("User cancelled photos app")),t()})),n.accept="image/*",n.click()}_getCameraPhoto(o,r){return new Promise((n,t)=>{const i=new FileReader,s=o.type.split("/")[1];"uri"===r.resultType?n({webPath:URL.createObjectURL(o),format:s,saved:!1}):(i.readAsDataURL(o),i.onloadend=()=>{const a=i.result;n("dataUrl"===r.resultType?{dataUrl:a,format:s,saved:!1}:{base64String:a.split(",")[1],format:s,saved:!1})},i.onerror=a=>{t(a)})})}checkPermissions(){var o=this;return(0,u.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw o.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw o.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var o=this;return(0,u.A)(function*(){throw o.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var o=this;return(0,u.A)(function*(){throw o.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var o=this;return(0,u.A)(function*(){throw o.unavailable("Not implemented on web.")})()}}new F;const R=(0,h.F3)("Camera",{web:()=>new F});var j=m(5079),I=m(5873),e=m(4438),k=m(8287),L=m(9967),E=m(9350),C=m(1626);const S=["postForm"];function A(l,o){if(1&l){const r=e.RV6();e.j41(0,"ion-button",21),e.bIt("click",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.cancel())}),e.EFF(1,"Cancel"),e.k0s()}}function M(l,o){if(1&l&&e.nrm(0,"img",22),2&l){const r=e.XpG();e.Y8G("src",r.imagePreview,e.B4B)}}function N(l,o){if(1&l){const r=e.RV6();e.j41(0,"ion-item",25),e.bIt("click",function(){const t=e.eBV(r).$implicit,i=e.XpG(2);return e.Njj(i.selectedLocation(t))}),e.nrm(1,"ion-icon",26),e.EFF(2),e.k0s()}if(2&l){const r=o.$implicit;e.R7$(2),e.SpI(" ",r.display_name,"")}}function D(l,o){if(1&l&&(e.j41(0,"ion-list",23)(1,"ion-note"),e.EFF(2,"Suggestions"),e.k0s(),e.DNE(3,N,3,1,"ion-item",24),e.k0s()),2&l){const r=e.XpG();e.R7$(3),e.Y8G("ngForOf",r.locationSuggestions)}}let x=(()=>{var l;class o{constructor(n,t,i,s,a,c){this.FirebaseService=n,this.Firestore=t,this.storage=i,this.toast=s,this.loadingController=a,this.http=c,this.selectedFile=null,this.caption="",this.location="",this.userDetails=null,this.imagePreview=null,this.loading=null,this.toastMessage="",this.showToast=!1,this.locationIqApiKey="pk.3a64257817134495e1b09946c4d2d0a4",this.locationSuggestions=[],(0,j.a)({locationOutline:I.UN$,camera:I.UIk})}presentLoader(){var n=this;return(0,u.A)(function*(){const t=yield n.loadingController.create({message:"Posting",spinner:"lines-sharp",mode:"ios"});return yield t.present(),t})()}dismissLoader(n){return(0,u.A)(function*(){yield n.dismiss()})()}ngOnInit(){var n=this;return(0,u.A)(function*(){const t=yield n.FirebaseService.getCurrentUser();t&&(n.userDetails=yield n.FirebaseService.loadUserDetail(t.uid))})()}cancel(){this.imagePreview=null,this.selectedFile=null,this.postForm.reset()}getLocationSuggestions(){const n=this.location;console.log(n),n&&""!==n.trim()?this.http.get(`https://us1.locationiq.com/v1/search.php?key=${this.locationIqApiKey}&q=${n}&format=json&limit=5`).subscribe(i=>{this.locationSuggestions=i}):""===n&&(this.locationSuggestions=[])}selectedLocation(n){this.location=n.display_name,this.locationSuggestions=[]}uploadFile(n){var t=this;return(0,u.A)(function*(){const i=n.target;if(i&&i.files&&i.files.length>0){const s=i.files[0];if(s.type.startsWith("image/")){t.selectedFile=s;const a=new FileReader;a.onload=()=>{console.log(a.result),t.imagePreview=a.result},a.readAsDataURL(s),t.toastMessage="Image uploaded successfully",t.showToast=!0}else console.error("Selected file is not an image"),t.imagePreview=null,t.selectedFile=null,t.toastMessage="Please select a valid image file",t.showToast=!0}else console.error("No file selected"),t.toastMessage="No file selected. Please choose an image.",t.showToast=!0})()}takePhoto(){var n=this;return(0,u.A)(function*(){try{const t=yield R.getPhoto({resultType:w.DataUrl,source:f.Camera,quality:100});n.imagePreview=t.dataUrl,console.log(n.imagePreview)}catch(t){console.error("Error capturing photo:",t),n.toastMessage="Error capturing photo",n.showToast=!0}})()}createPost(n){var t=this;return(0,u.A)(function*(){try{const i=yield t.presentLoader();if(t.imagePreview){const s=(0,b.KR)(t.storage,`posts/${(new Date).getTime()}_photo.jpg`),a=yield fetch(t.imagePreview);console.log(a);const c=yield a.blob();console.log(c),yield(0,b.D)(s,c);const p=yield(0,b.qk)(s),y=(0,_.rJ)(t.Firestore,"posts");yield(0,_.gS)(y,{postLink:p,caption:t.caption,location:t.location,uid:t.userDetails.uid,likes:0,comments:0,createdAt:(0,_.O5)()}),n.resetForm(),t.caption="",t.location="",t.imagePreview=null,t.selectedFile=null;const U=document.querySelector('input[type="file"]');U&&(U.value=""),t.toastMessage="Post Created Successfully! \u{1f389}",t.showToast=!0}else t.toastMessage="Please select an image to upload",t.showToast=!0;yield t.dismissLoader(i)}catch(i){console.log(i),t.toastMessage="Oops! \u{1f61e} Something went wrong while creating your post.",t.showToast=!0}})()}}return(l=o).\u0275fac=function(n){return new(n||l)(e.rXU(k.f),e.rXU(L._7),e.rXU(b.wc),e.rXU(E.K_),e.rXU(E.Xi),e.rXU(C.Qq))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-tab3"]],viewQuery:function(n,t){if(1&n&&e.GBs(S,5),2&n){let i;e.mGM(i=e.lsd())&&(t.postForm=i.first)}},standalone:!0,features:[e.aNF],decls:30,vars:8,consts:[["postForm","ngForm"],["postContentInput","ngModel"],[1,"ion-no-border"],["mode","md"],["slot","end"],[3,"click",4,"ngIf"],["mode","ios"],[1,"ion-padding"],["size","large","color","primary"],["type","file","accept","image/*","required","","name","post","id","fileInput",2,"display","none",3,"change"],["for","fileInput",2,"cursor","pointer"],["alt","Image Preview",3,"src",4,"ngIf"],[1,"ion-margin"],["type","text","label","What's on your mind?","labelPlacement","floating","required","","name","postContent",3,"ngModelChange","ngModel"],["type","text","label","Add location","labelPlacement","floating","name","location","required","",3,"ngModelChange","ionInput","ngModel"],["class","ion-margin ion-padding",4,"ngIf"],["slot","fixed","vertical","bottom","horizontal","end"],["color","secondary",3,"click"],["name","camera"],["type","submit","size","default","color","primary","expand","block",3,"click","disabled"],["duration","3000","position","top",3,"didDismiss","isOpen","message"],[3,"click"],["alt","Image Preview",3,"src"],[1,"ion-margin","ion-padding"],["class","ion-padding-top",3,"click",4,"ngFor","ngForOf"],[1,"ion-padding-top",3,"click"],["name","location-outline","slot","start"]],template:function(n,t){if(1&n){const i=e.RV6();e.j41(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-title",3),e.EFF(3,"Create Post"),e.k0s(),e.j41(4,"ion-buttons",4),e.DNE(5,A,2,0,"ion-button",5),e.k0s()()(),e.j41(6,"ion-content",6),e.nrm(7,"ion-loading"),e.j41(8,"form",null,0)(10,"ion-card",7)(11,"ion-button",8)(12,"input",9),e.bIt("change",function(a){return e.eBV(i),e.Njj(t.uploadFile(a))}),e.k0s(),e.j41(13,"label",10),e.EFF(14,"Upload Image"),e.k0s()(),e.DNE(15,M,1,1,"img",11),e.k0s(),e.j41(16,"ion-list",12)(17,"ion-item")(18,"ion-input",13,1),e.mxI("ngModelChange",function(a){return e.eBV(i),e.DH7(t.caption,a)||(t.caption=a),e.Njj(a)}),e.k0s()(),e.j41(20,"ion-item")(21,"ion-input",14),e.mxI("ngModelChange",function(a){return e.eBV(i),e.DH7(t.location,a)||(t.location=a),e.Njj(a)}),e.bIt("ionInput",function(){return e.eBV(i),e.Njj(t.getLocationSuggestions())}),e.k0s()()(),e.DNE(22,D,4,1,"ion-list",15),e.k0s(),e.j41(23,"ion-fab",16)(24,"ion-fab-button",17),e.bIt("click",function(){return e.eBV(i),e.Njj(t.takePhoto())}),e.nrm(25,"ion-icon",18),e.k0s()()(),e.j41(26,"ion-footer")(27,"ion-button",19),e.bIt("click",function(){e.eBV(i);const a=e.sdS(9);return e.Njj(t.createPost(a))}),e.EFF(28," Post "),e.k0s()(),e.j41(29,"ion-toast",20),e.bIt("didDismiss",function(){return e.eBV(i),e.Njj(t.showToast=!1)}),e.k0s()}if(2&n){const i=e.sdS(9);e.R7$(5),e.Y8G("ngIf",t.imagePreview||i.valid),e.R7$(10),e.Y8G("ngIf",t.imagePreview),e.R7$(3),e.R50("ngModel",t.caption),e.R7$(3),e.R50("ngModel",t.location),e.R7$(),e.Y8G("ngIf",t.locationSuggestions.length>0),e.R7$(5),e.Y8G("disabled",i.invalid),e.R7$(2),e.FS9("message",t.toastMessage),e.Y8G("isOpen",t.showToast)}},dependencies:[d.rQ,d.QW,d.eU,d.iq,d.YW,d.Q8,d.op,d.JI,d.M0,g.YN,g.qT,g.BC,g.cb,g.YS,g.vS,g.cV,v.MD,v.Sq,v.bT,d.uz,d.nf,d.$w,d.Jm,d.b_,d.ai,d.BC,d.W9],styles:["ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{display:flex;justify-content:center;flex-direction:column;align-items:center;padding:80px 10px}"]}),o})()}}]);